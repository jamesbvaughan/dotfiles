#!/bin/bash

# This script configures MacOS how I like it.
# It's meant to be idempotent so that it can safely be re-run at any time.

set -euo pipefail

pushd ~/.dotfiles

# Install Homebrew
which -s brew || curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh

# Install things distributed as Homebrew packages
export HOMEBREW_NO_ENV_HINTS=true
brew install --quiet \
	bat \
	coreutils \
	fd \
	fzf \
	neovim \
  docker-compose \
	rg \
	zsh \
	exa \
  highlight \
	htop \
	hub \
  git \
	koekeishiya/formulae/yabai \
  lua-language-server \
  luarocks \
	markdownlint-cli \
	nodenv \
  prettier \
	rbenv \
	shellcheck \
	skhd \
	starship \
	stow \
	stylua \
  tldr \
	tmux \
	tree \
	yamllint

# Install some casks
brew install --quiet --cask \
  alfred \
  docker \
  keepingyouawake
#   # Add this back once the cask is > v3.5
#   # iterm2

# Place config files where they belong
stow \
	alfred \
	git \
	hushlogin \
	iterm2 \
	luacheck \
	neovim \
	skhd \
	tmux \
	yabai \
	zsh

# Install some things that are distributed as npm packages
npm install --global \
  @prisma/language-server \
  bash-language-server

# Install Oh My ZSH
test -d ~/.oh-my-zsh || sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

# Enable global key-repeat
defaults write -g ApplePressAndHoldEnabled -bool false

popd

echo 'Finished.'
